# Лабораторная работа 1

## Сборка базового проекта на основе Zynq

## Предисловие

Для лабораторной работы представлена обобщенная инструкция. Можете выполнять лабораторную работу по ней, если вам это под силу. Если же нет, то в лабораторной работе представлена пошаговая инструкция.

---

## Обзор

Vivado Design Suite WebPACK содержит в себе все необходимые средства для проектирования на базе FPGA и систем на кристале, включая SDK для разработки программных средств. Для выполнения лабораторных работ также потребуется поддержка Vivado Logic Analyzer.

В отличии от традиционных процессоров, процессорная система Zynq (PS - Processing System) содержит настраиваемый набор встроенной периферии. Более того, имеется прямой доступ к программируемой логике (PL - Programmable Logic), с помощью которой можно собрать любой сложнофункциональный блок (IP - intellectual property). Более того PS может быть использован без программирования PL. Однако, для использования какого-то IP в PL или использования процессорной системой периферии относящейся к PL потребуется программирование PL.

Практическая часть лабораторной работы соответствует указаниям Xilinx из UltraFast Design Methodology. Термин "методология" для разных людей трактуется по-разному. Блок-схемы, методы, принципы, правила, политики - вот лишь некоторые из возможных тем. Данная методология не предоставляет пошаговую инструкцию для успешного выполнения задачи. Вместо этого цель состоит в том, чтобы снабдить разработчиков информацией и руководством по проектированию встраиваемых систем, чтобы они могли принимать обоснованные решения при использовании предоставленного набора инструментов. Некоторая часть содержания применима в целом к встраиваемым системам, в то время как другая часть специфична для продуктов Xilinx® All-Programmable SoC. Для получения дополнительной информации о преимуществах методологии UltraFast Design, пожалуйста, обратитесь к документам Xilinx User Guide UG949 и UG1046. Ссылки на эти два документа приведены в конце этой лабораторной работы.

Эта лабораторная работа проиллюстрирует пример того, как создать новый проект Zynq с использованием UltraFast Design Methodology с помощью набора инструментов Vivado Design Suite.

## Цель работы

После выполнения лабораторной работы вы сможете:

* Создавать новый проект в Vivado
* Привязывать Zynq 72010 или 72020 к проекту
* Создавать новый Block Design в соответствии с циклом разработки IP Integrator.
* Добавлять встроенное ядро ARM-процессора в проект

## Эксперимент 1: Создание проекта Zynq в Vivado

Vivado имеет большое количество встроенных платформ для разработки, такие как Avnet ZedBoard или MicroZed. Однако для данной работы проект Zynq будет создан с нуля.

---

### **Обобщенная инструкция:**

Запустите Vivado 2023.1 и создайте проект в заданной директории:

```
  C:\ZynqHW\2023.1\
```

---

### **Пошаговая инструкция:**

1. Запустите Vivado 2023.1 с помощью иконки на рабочем столе.

2. В поле **Quick Start** выберите **Create Project**.

    ![Создание проекта Vivado](./resources/lab1/Vivado%20Project%20Creation.png)

3. В появившемся окне нажмите кнопку **Next**

4. В окне *Project Name* Введите в поле *Project Name* имя проекта `ZynqDesign`. В поле *Project Location* введите директорию, в которой будет располагаться проект. Например, `D:\ZynqHW\2023.1\\`. Убедитесь, что включено создание поддиректории проекта (чекбокс *Create project subdirectory*).

    ![Имя проекта и его локация](./resources/lab1/New%20Project%20Name%20and%20Location.png)

5. Нажмите кнопку **Next**.

6. В окне *Project Type* для данной лабораторной работы необходимо выбрать пункт RTL Project. Нажмите кнопку **Next**.

    ![Настройка типа проекта](./resources/lab1/Project%20Type%20Settings.png)

7. Важно: в окне *Add Sources* в поле *Target Language* выберите **VHDL**. Нажмите кнопку **Next** два раза.
    
    ![Настройка добавления исходников](./resources/lab1/Add%20Sources%20Settings.png)

8. Далее в окне *Default Part* необходимо выбрать целевое устройство. Для этого можно выбрать определенные части устройства или плату целиком. Несмотря на то, что здесь мы можем выбрать плату *ZedBoard*, мы не будем делать этого, так как для данной лабораторной работы целью является создание своей собственной сборки. В поле *Select* необходимо выбрать опцию **Parts**. Выберите следующие опции фильтра:
    * *Category* — **General Purpose**
    * *Famlily* — **Zynq-7000**
    * *Package* — **clg484**
    * *Speed* — **-1**
    * *Temperature* — **All Remaining**
    * *Static power* — **All Remaining**

    В списке устройств необходимо выбрать **xc7z020clg484-1**. Нажмите кнопку **Next**.

    ![Выбор целевого устройства](./resources/lab1/Target%20Device%20Config.png)

9. В окне *New Project Summary* появилась общая информация о проекте. Нажмите кнопку **Finish**.
    
    ![Общая информация о проекте](./resources/lab1/New%20Project%20Summary.png)

В результате появится интерфейс Vivado Design. Изучите доступные функции и ответьте на вопросы ниже.

    ![Интерфейс Vivado Design](./resources/lab1/Vivado%20Design%20Cockpit.png)

---

### **Вопросы:**

* Какое устройство выбрано? Почему в проекте отсутствует верхний модуль иерархии (Top Module)?
* Какие выбраны стратегия синтеза и имплементации Vivado (Vivado Synthesis and Implementation Strategies)?
* Какая еще информация доступна в краткой информации о проекте (Project Summary)?

## Эксперимент 2: Создать новый Block Design в Vivado

Текущий проект пуст. Чтобы получить доступ к процессорной системе ARM, добавим встроенное ядро в проект Vivado, создавая Block Design при помощи IP-интегратора (IP Integrator).

---

### **Обобщенная инструкция:**

Создайте Block Design и добавьте туда процессорное ядро.

---

### **Пошаговая инструкция:**

1. В области окна *Flow Navigator* найдите меню *IP Integrator*. В нем выберите пункт **Create block design**.

    ![Создание блочного дизайна](./resources/lab1/Create%20Block%20Design.png)

2. В появившемся окне в поле *Design name* введите имя дизайна `Z_system`. Нажмите кнопку **Ok**.

3. В Vivado появится область с диаграммой нашей *Z-system*. Выберите иконку **Add IP** с верхней панели или из области диаграммы.

    ![Добавить IP](./resources/lab1/Add%20IP.png)

4. В появившемся окне поиска введите `zynq`, чтобы отфильтровать список имеющихся IP. Нажмите два раза на **ZYNQ7 Processing System**

    ![СФ-блок процессорной системы Zynq](./resources/lab1/Zynq%20Processing%20System.png)

5. Диаграмма теперь содержит IP-блок *processing_system7_0*. В зеленой навигационной панели можно увидеть сообщение от *Designer Assistant*. В Block Design большинство IP-блоков может быть автоматически подключено при выборе *Run Block Automation*. Нажмите на **Run Block Automation**, чтобы выполнить автоматическое подключение процессорного ядра ARM.

    ![Запустить автоматическое подключение блоков](./resources/lab1/Run%20Block%20Automation.png)

6. Запущенное автоматическое средство самостоятельно определяет внешние интерфейсы *DDR* и *FIXED_IO*, которые необходимо подключить. *FIXED_IO* - это интерфейсы I/O, предназначенные для внутренних вшитых периферийных устройств в процессорной системе Zynq, включая UART, Ethernet, USB и другие IP. Их коснемся позже. Сейчас нажмите кнопку **Ok** для запуска средства автоматического подключения. Средство определяет эти порты, как внешние интерфейсы. Block Design может быть частью большего модуля, поэтому его внешние интерфейсы обязательно должны быть определены.

    ![Соединение внешних интерфейсов](./resources/lab1/Click%20OK%20to%20connect%20external%20interfaces.png)

    Два внешних порта теперь соединены с IP-блоком.

    ![Внешнее соединение портов](./resources/lab1/External%20Port%20Connections.png)

7. Нажмите кнопку **Save Block Design** в верхней панели Vivado для сохранения Block Design.

    ![Сохранение Block Design](./resources/lab1/Save%20Block%20Design.png)

8. На данный момент PS ZYNQ7 полностью не сконфигурирована. Чтобы настроить нашу систему два раза нажмите на **ZYNQ7 Processing System** IP-блок. Большинство IP может быть кастомизировано таким образом.

    ![Кастомизация IP](./resources/lab1/Double%20Click%20on%20IP%20to%20customize%20the%20IP.png)

В появившемся окне *Zynq Recustomize IP* можно настраивать процессорное ядро Zynq. В данный момент все функции PS настроены на их значение по-умолчанию, готовые к кастомизации. Кастомизация будет выполнена в некоторых из следующих лабораторных работ.

    ![Рекастомизация процессорной системы](./resources/lab1/Re-Customize%20IP%20window%20for%20the%20Zynq%20PS.png)

Таким образом был создан новый проект, в который было добавлено встроенное процессорное ядро. Оставьте проект для второй лабораторной работы.

---

### **Вопросы:**

* Перечислите некоторые конфигурируемые компоненты (выделены зеленым) в Zynq PS.
* I/O-периферия соединена с внешними портами через I/O-мультиплексор (MIO). Какое количество I/O доступно в MIO?  

## Дальнейшее изучение

При наличии свободного времени можно также изучить:

* Исследуйте некоторые другие настраиваемые блоки PS.

* Откройте Техническое Руководство по Zynq (TRM) и просмотрите доступные разделы. Его можно найти онлайн: http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf

* Для пользователей ISE или PlanAhead: откройте Migration Methodology Guide. Этот документ предоставляет инструкции по переносу проектов из ISE в Vivado и обновлению UCF-constraints в XDC. Это можно найти в папке Документации поддержки, или онлайн: http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_2/ug911-vivado-migration.pdf

* Для получения дополнительной информации о преимуществах методологии UltraFast Design Methodology, пожалуйста, обратитесь к документам Руководства Пользователя Xilinx UG949 и UG1046. Эти документы могут быть найдены в интернете: http://www.xilinx.com/support/documentation/sw_manuals/ug949-vivado-design-methodology.pdf http://www.xilinx.comcom/support/documentation/sw_manuals/ug1046-ultrafast-design-methodologyguide.pdf

## Источники:

www.microzed.org

www.picozed.org

www.zedboard.org

www.xilinx.com/zynq

www.xilinx.com/sdk

www.xilinx.com/vivado

www.xilinx.com/support/documentation/sw_manuals/ug949-vivado-design-methodology.pdf

www.xilinx.com/support/documentation/sw_manuals/ug1046-ultrafast-design-methodology-guide.pdf

## Ответы

> Какое устройство выбрано? Почему в проекте отсутствует верхний модуль иерархии (Top Module)?

Устройство - xc7z020clg484-1. Так как это абсолютно новый проект, то верхний модуль иерархии еще не создан. Он будет создан позднее и появится в области *Design Sources*

> Какие выбраны стратегия синтеза и имплементации Vivado (Vivado Synthesis and Implementation Strategies)?

Обе стратегии установлены по умолчанию. Поле стратегии находится в *Project Summary*.

> Какая еще информация доступна в краткой информации о проекте (Project Summary)?

В *Project Summary* содержится информации о статусе синтеза и имплементации, Нарушения DRC, статистика утилизации устройства, информация о потребляемой мощности, результаты временного анализа.

> Перечислите некоторые конфигурируемые компоненты (выделены зеленым) в Zynq PS.

I/O Периферия, Общие настройки, интерфейсы Flash памяти, Тактовая генерация, AXI
порты, контроллер памяти DDR, и другое.

> I/O-периферия соединена с внешними портами через I/O-мультиплексор (MIO). Какое количество I/O доступно в MIO?  

Всего 54 - 16 в MIO BANK 0 и 38 в MIO BANK 1.
